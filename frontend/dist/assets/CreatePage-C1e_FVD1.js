import{j as t,r as u,c as v,u as ee}from"./index-DgtH0Sqm.js";import{c as te,u as ne}from"./authStore-JTGfq0hL.js";import{I as D}from"./index-DGT-xrSd.js";import{a as X}from"./apiRequests-CS8AnOA_.js";import{u as ae,a as re}from"./useMutation-C1y1FuqP.js";import{c as $}from"./createLucideIcon-Jv87yse_.js";import"./useBaseQuery-gpRBczeQ.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],se=$("pencil",oe);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],le=$("upload",ie);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],de=$("x",ce),F=te(e=>({selectedLayer:"canvas",textOptions:{text:"",fontSize:48,color:"#000000",top:48,left:0},canvasOptions:{height:0,orientation:"",size:"original",backgroundColor:"#008080"},setSelectedLayer:n=>e({selectedLayer:n}),setTextOptions:n=>e({textOptions:n}),addText:()=>e({textOptions:{text:"Add text",fontSize:48,color:"#000000",top:48,left:0}}),setCanvasOptions:n=>e({canvasOptions:n}),resetStore:()=>e({selectedLayer:"canvas",textOptions:{text:"",fontSize:48,color:"#000000",top:48,left:0},canvasOptions:{height:0,orientation:"",size:"original",backgroundColor:"#008080"}})})),ue=()=>{const{selectedLayer:e,setSelectedLayer:n,addText:a,canvasOptions:o}=F(),r=s=>{n(s),s==="text"&&a()};return t.jsxs("div",{className:"layers",children:[t.jsxs("div",{className:"layersTitle",children:[t.jsx("h3",{children:"Layers"}),t.jsx("p",{children:"Select a layer to edit"})]}),t.jsxs("div",{onClick:()=>r("text"),className:`layer ${e==="text"?"selected":""}`,children:[t.jsx("div",{className:"layerImage",children:t.jsx(D,{path:"/general/text.png",alt:"",w:48,h:48})}),t.jsx("span",{children:"Add Text"})]}),t.jsxs("div",{onClick:()=>r("canvas"),className:`layer ${e==="canvas"?"selected":""}`,children:[t.jsx("div",{className:"layerImage",style:{backgroundColor:o.backgroundColor}}),t.jsx("span",{children:"Canvas"})]})]})},he=({preview:e})=>{const{setSelectedLayer:n,textOptions:a,setTextOptions:o,canvasOptions:r,setCanvasOptions:s}=F();u.useEffect(()=>{if(r.height===0){const b=375*e.height/e.width;s({...r,height:b,orientation:b>375?"portrait":"landscape"})}},[e,r,s]);const d=u.useRef(null),l=u.useRef(null),h=u.useRef(!1),c=u.useRef({x:0,y:0}),f=b=>{h.current&&o({...a,left:b.clientX-c.current.x,top:b.clientY-c.current.y})},i=()=>{h.current=!1},p=()=>{h.current=!1},w=b=>{n("text"),h.current=!0,c.current={x:b.clientX-a.left,y:b.clientY-a.top}};return t.jsx("div",{className:"workspace",children:t.jsxs("div",{className:"canvas",style:{height:r.height,backgroundColor:r.backgroundColor},onMouseMove:f,onMouseUp:i,onMouseLeave:p,ref:l,children:[t.jsx("img",{src:e.url,alt:""}),a.text&&t.jsxs("div",{className:"text",style:{left:a.left,top:a.top,fontSize:`${a.fontSize}px`},ref:d,onMouseDown:w,children:[t.jsx("input",{type:"text",value:a.text,onChange:b=>o({...a,text:b.target.value}),style:{color:a.color}}),t.jsx("div",{className:"deleteTextButton",onClick:()=>o({...a,text:""}),children:t.jsx(D,{path:"/general/delete.svg",alt:""})})]})]})})};function I(){return(I=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e}).apply(this,arguments)}function Y(e,n){if(e==null)return{};var a,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)n.indexOf(a=s[o])>=0||(r[a]=e[a]);return r}function B(e){var n=u.useRef(e),a=u.useRef(function(o){n.current&&n.current(o)});return n.current=e,a.current}var O=function(e,n,a){return n===void 0&&(n=0),a===void 0&&(a=1),e>a?a:e<n?n:e},k=function(e){return"touches"in e},R=function(e){return e&&e.ownerDocument.defaultView||self},A=function(e,n,a){var o=e.getBoundingClientRect(),r=k(n)?function(s,d){for(var l=0;l<s.length;l++)if(s[l].identifier===d)return s[l];return s[0]}(n.touches,a):n;return{left:O((r.pageX-(o.left+R(e).pageXOffset))/o.width),top:O((r.pageY-(o.top+R(e).pageYOffset))/o.height)}},q=function(e){!k(e)&&e.preventDefault()},J=v.memo(function(e){var n=e.onMove,a=e.onKey,o=Y(e,["onMove","onKey"]),r=u.useRef(null),s=B(n),d=B(a),l=u.useRef(null),h=u.useRef(!1),c=u.useMemo(function(){var w=function(j){q(j),(k(j)?j.touches.length>0:j.buttons>0)&&r.current?s(A(r.current,j,l.current)):C(!1)},b=function(){return C(!1)};function C(j){var g=h.current,N=R(r.current),y=j?N.addEventListener:N.removeEventListener;y(g?"touchmove":"mousemove",w),y(g?"touchend":"mouseup",b)}return[function(j){var g=j.nativeEvent,N=r.current;if(N&&(q(g),!function(L,z){return z&&!k(L)}(g,h.current)&&N)){if(k(g)){h.current=!0;var y=g.changedTouches||[];y.length&&(l.current=y[0].identifier)}N.focus(),s(A(N,g,l.current)),C(!0)}},function(j){var g=j.which||j.keyCode;g<37||g>40||(j.preventDefault(),d({left:g===39?.05:g===37?-.05:0,top:g===40?.05:g===38?-.05:0}))},C]},[d,s]),f=c[0],i=c[1],p=c[2];return u.useEffect(function(){return p},[p]),v.createElement("div",I({},o,{onTouchStart:f,onMouseDown:f,className:"react-colorful__interactive",ref:r,onKeyDown:i,tabIndex:0,role:"slider"}))}),H=function(e){return e.filter(Boolean).join(" ")},Q=function(e){var n=e.color,a=e.left,o=e.top,r=o===void 0?.5:o,s=H(["react-colorful__pointer",e.className]);return v.createElement("div",{className:s,style:{top:100*r+"%",left:100*a+"%"}},v.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:n}}))},x=function(e,n,a){return n===void 0&&(n=0),a===void 0&&(a=Math.pow(10,n)),Math.round(a*e)/a},fe=function(e){return ve(T(e))},T=function(e){return e[0]==="#"&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?x(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:e.length===8?x(parseInt(e.substring(6,8),16)/255,2):1}},me=function(e){return xe(ge(e))},pe=function(e){var n=e.s,a=e.v,o=e.a,r=(200-n)*a/100;return{h:x(e.h),s:x(r>0&&r<200?n*a/100/(r<=100?r:200-r)*100:0),l:x(r/2),a:x(o,2)}},P=function(e){var n=pe(e);return"hsl("+n.h+", "+n.s+"%, "+n.l+"%)"},ge=function(e){var n=e.h,a=e.s,o=e.v,r=e.a;n=n/360*6,a/=100,o/=100;var s=Math.floor(n),d=o*(1-a),l=o*(1-(n-s)*a),h=o*(1-(1-n+s)*a),c=s%6;return{r:x(255*[o,l,d,d,h,o][c]),g:x(255*[h,o,o,l,d,d][c]),b:x(255*[d,d,h,o,o,l][c]),a:x(r,2)}},E=function(e){var n=e.toString(16);return n.length<2?"0"+n:n},xe=function(e){var n=e.r,a=e.g,o=e.b,r=e.a,s=r<1?E(x(255*r)):"";return"#"+E(n)+E(a)+E(o)+s},ve=function(e){var n=e.r,a=e.g,o=e.b,r=e.a,s=Math.max(n,a,o),d=s-Math.min(n,a,o),l=d?s===n?(a-o)/d:s===a?2+(o-n)/d:4+(n-a)/d:0;return{h:x(60*(l<0?l+6:l)),s:x(s?d/s*100:0),v:x(s/255*100),a:r}},je=v.memo(function(e){var n=e.hue,a=e.onChange,o=H(["react-colorful__hue",e.className]);return v.createElement("div",{className:o},v.createElement(J,{onMove:function(r){a({h:360*r.left})},onKey:function(r){a({h:O(n+360*r.left,0,360)})},"aria-label":"Hue","aria-valuenow":x(n),"aria-valuemax":"360","aria-valuemin":"0"},v.createElement(Q,{className:"react-colorful__hue-pointer",left:n/360,color:P({h:n,s:100,v:100,a:1})})))}),be=v.memo(function(e){var n=e.hsva,a=e.onChange,o={backgroundColor:P({h:n.h,s:100,v:100,a:1})};return v.createElement("div",{className:"react-colorful__saturation",style:o},v.createElement(J,{onMove:function(r){a({s:100*r.left,v:100-100*r.top})},onKey:function(r){a({s:O(n.s+100*r.left,0,100),v:O(n.v-100*r.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+x(n.s)+"%, Brightness "+x(n.v)+"%"},v.createElement(Q,{className:"react-colorful__saturation-pointer",top:1-n.v/100,left:n.s/100,color:P(n)})))}),V=function(e,n){if(e===n)return!0;for(var a in e)if(e[a]!==n[a])return!1;return!0},Ne=function(e,n){return e.toLowerCase()===n.toLowerCase()||V(T(e),T(n))};function ye(e,n,a){var o=B(a),r=u.useState(function(){return e.toHsva(n)}),s=r[0],d=r[1],l=u.useRef({color:n,hsva:s});u.useEffect(function(){if(!e.equal(n,l.current.color)){var c=e.toHsva(n);l.current={hsva:c,color:n},d(c)}},[n,e]),u.useEffect(function(){var c;V(s,l.current.hsva)||e.equal(c=e.fromHsva(s),l.current.color)||(l.current={hsva:s,color:c},o(c))},[s,e,o]);var h=u.useCallback(function(c){d(function(f){return Object.assign({},f,c)})},[]);return[s,h]}var Ce=typeof window<"u"?u.useLayoutEffect:u.useEffect,we=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},K=new Map,_e=function(e){Ce(function(){var n=e.current?e.current.ownerDocument:document;if(n!==void 0&&!K.has(n)){var a=n.createElement("style");a.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,K.set(n,a);var o=we();o&&a.setAttribute("nonce",o),n.head.appendChild(a)}},[])},ke=function(e){var n=e.className,a=e.colorModel,o=e.color,r=o===void 0?a.defaultColor:o,s=e.onChange,d=Y(e,["className","colorModel","color","onChange"]),l=u.useRef(null);_e(l);var h=ye(a,r,s),c=h[0],f=h[1],i=H(["react-colorful",n]);return v.createElement("div",I({},d,{ref:l,className:i}),v.createElement(be,{hsva:c,onChange:f}),v.createElement(je,{hue:c.h,onChange:f,className:"react-colorful__last-control"}))},Oe={defaultColor:"000",toHsva:fe,fromHsva:function(e){return me({h:e.h,s:e.s,v:e.v,a:1})},equal:Ne},U=function(e){return v.createElement(ke,I({},e,{colorModel:Oe}))};const Se=[{name:"1:2",width:1,height:2},{name:"9:16",width:9,height:16},{name:"2:3",width:2,height:3},{name:"3:4",width:3,height:4},{name:"4:5",width:4,height:5},{name:"1:1",width:1,height:1}],Me=[{name:"2:1",width:2,height:1},{name:"16:9",width:16,height:9},{name:"3:2",width:3,height:2},{name:"4:3",width:4,height:3},{name:"5:4",width:5,height:4},{name:"1:1",width:1,height:1}],Ee=({preview:e})=>{const{selectedLayer:n,textOptions:a,setTextOptions:o,canvasOptions:r,setCanvasOptions:s}=F(),[d,l]=u.useState(!1),h=e.width<e.height?"portrait":"landscape",c=i=>{let p;h===i?p=375*e.height/e.width:p=375*e.width/e.height,s({...r,orientation:i,size:"original",height:p})},f=i=>{let p;i==="original"?h===r.orientation?p=375*e.height/e.width:p=375*e.width/e.height:p=375*i.height/i.width,s({...r,size:i==="original"?"original":i.name,height:p})};return t.jsx("div",{className:"options",children:n==="text"?t.jsxs("div",{className:"",children:[t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Font Size"}),t.jsx("input",{type:"number",value:a.fontSize,onChange:i=>o({...a,fontSize:i.target.value})})]}),t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Color"}),t.jsxs("div",{className:"textColor",children:[t.jsx("div",{className:"colorPreview",style:{backgroundColor:a.color},onClick:()=>l(i=>!i)}),d&&t.jsx("div",{className:"colorPicker",children:t.jsx(U,{color:a.color,onChange:i=>o({...a,color:i})})})]})]})]}):t.jsxs("div",{className:"",children:[t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Orientation"}),t.jsxs("div",{className:"orientations",children:[t.jsx("div",{className:`orientation ${r.orientation==="portrait"?"selected":""}`,onClick:()=>c("portrait"),children:"P"}),t.jsx("div",{className:`orientation ${r.orientation==="landscape"?"selected":""}`,onClick:()=>c("landscape"),children:"L"})]})]}),t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Size"}),t.jsxs("div",{className:"sizes",children:[t.jsx("div",{className:`size ${r.size==="original"?"selected":""}`,onClick:()=>f("original"),children:"Original"}),r.orientation==="portrait"?t.jsx(t.Fragment,{children:Se.map(i=>t.jsx("div",{className:`size ${r.size===i.name?"selected":""}`,onClick:()=>f(i),children:i.name},i.name))}):t.jsx(t.Fragment,{children:Me.map(i=>t.jsx("div",{className:`size ${r.size===i.name?"selected":""}`,onClick:()=>f(i),children:i.name},i.name))})]})]}),t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Background Color"}),t.jsx("div",{className:"bgColor",children:t.jsxs("div",{className:"textColor",children:[t.jsx("div",{className:"colorPreview",style:{backgroundColor:r.backgroundColor},onClick:()=>l(i=>!i)}),d&&t.jsx("div",{className:"colorPicker",children:t.jsx(U,{color:r.backgroundColor,onChange:i=>s({...r,backgroundColor:i})})})]})})]})]})})},Fe=({preview:e})=>t.jsxs("div",{className:"editor w-full",children:[t.jsx(ue,{preview:e}),t.jsx(he,{preview:e}),t.jsx(Ee,{preview:e})]}),Ie=({setIsNewBoardOpen:e,setNewBoard:n})=>{const a=o=>{o.preventDefault();const r=o.target[0].value;n(r),e(!1)};return t.jsx("div",{className:"boardForm",children:t.jsxs("div",{className:"boardFormContainer",children:[t.jsx("div",{className:"boardFormClose",onClick:()=>e(!1),children:t.jsx(D,{src:"/general/cancel.svg",alt:"",w:20,h:20})}),t.jsxs("form",{onSubmit:a,children:[t.jsx("h1",{children:"Create a new board"}),t.jsx("input",{type:"text",placeholder:"Board Title"}),t.jsx("button",{children:"Create"})]})]})})},Le=async e=>{const n=await X.post("/pins",e,{headers:{"Content-Type":"multipart/form-data"}});return console.log(n),n.data},He=()=>{const e=ee(),{currentUser:n}=ne(),{textOptions:a,canvasOptions:o,resetStore:r}=F(),s=u.useRef(),[d,l]=u.useState(null),[h,c]=u.useState(null),[f,i]=u.useState(!1),[p,w]=u.useState(""),[b,C]=u.useState(!1);u.useEffect(()=>{n||e("/auth")},[e,n]);const j=m=>{const S=m.target.files[0];if(l(S),S){const _=new FileReader;_.onloadend=()=>{const M=new Image;M.onload=()=>{c({url:_.result,width:M.width,height:M.height})},M.src=_.result},_.readAsDataURL(S)}else c(null)},g=()=>{l(null),c(null)},N=()=>i(!0),{data:y,isPending:L,error:z}=ae({queryKey:["formBoards"],queryFn:()=>X.get(`/boards/${n._id}`).then(m=>m.data)}),W=()=>C(m=>!m),Z=re({mutationFn:Le,onSuccess:(m,S,_)=>{console.log("Final Response:",m),r(),e(`/pin/${m._id}`)}}),G=()=>{if(f)i(!1);else{const m=new FormData(s.current);m.append("media",d),m.append("textOptions",JSON.stringify(a)),m.append("canvasOptions",JSON.stringify(o)),m.append("newBoard",p),Z.mutate(m)}};return t.jsxs("div",{className:"createPage",children:[t.jsxs("div",{className:"createTop",children:[t.jsx("h1",{children:f?"Edit your pic":"Create Pin"}),t.jsx("button",{onClick:G,children:f?"Done":"Publish"})]}),t.jsx("div",{className:"createBottom",children:f?t.jsx(Fe,{preview:h}):t.jsxs(t.Fragment,{children:[t.jsxs("label",{className:"upload cursor-pointer relative",children:[h?t.jsxs("div",{className:"relative w-full h-full",children:[t.jsx("img",{src:h.url,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}),t.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[t.jsx("button",{type:"button",onClick:N,className:"bg-black/70 text-white p-1 rounded-full hover:bg-black",children:t.jsx(se,{size:18})}),t.jsx("button",{type:"button",onClick:g,className:"bg-black/70 text-white p-1 rounded-full hover:bg-black",children:t.jsx(de,{size:18})})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"uploadTitle",children:t.jsx(le,{})}),t.jsx("div",{className:"uploadInfo",children:"Click to upload a high-quality .jpg (max 200MB)"})]}),t.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"hidden"})]}),t.jsxs("form",{className:"createForm",ref:s,children:[t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"title",children:"Title"}),t.jsx("input",{type:"text",placeholder:"Add a title",name:"title",id:"title"})]}),t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"description",children:"Description"}),t.jsx("textarea",{rows:6,placeholder:"Add a detailed description",name:"description",id:"description"})]}),t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"link",children:"Link"}),t.jsx("input",{type:"text",placeholder:"Add a link",name:"link",id:"link"})]}),!L&&!z&&t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"board",children:"Board"}),t.jsxs("select",{name:"board",id:"board",children:[t.jsx("option",{value:"",children:"Choose a board"}),y==null?void 0:y.map(m=>t.jsx("option",{value:m._id,children:m.title},m._id))]}),t.jsxs("div",{className:"newBoard",children:[p&&t.jsx("div",{className:"newBoardContainer",children:t.jsx("div",{className:"newBoardItem",children:p})}),t.jsx("div",{className:"createBoardButton",onClick:W,children:"Create new board"})]})]}),t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"tags",children:"Tagged topics"}),t.jsx("input",{type:"text",placeholder:"Add tags",name:"tags",id:"tags"}),t.jsx("small",{children:"Don't worry, people won't see your tags"})]})]}),b&&t.jsx(Ie,{setIsNewBoardOpen:C,setNewBoard:w})]})})]})};export{He as default};
